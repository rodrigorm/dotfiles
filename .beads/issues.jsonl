{"id":"dotfiles-0np","title":"Document shell script patterns and conventions","description":"Create comprehensive documentation for bash script patterns used in this dotfiles repo","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T16:45:28.10236-03:00","updated_at":"2025-12-11T17:39:46.178647-03:00","closed_at":"2025-12-11T17:39:46.178647-03:00"}
{"id":"dotfiles-58s","title":"Add cross-platform package manager support","description":"Support multiple package managers (apt, yum, brew) in Comtrya manifests","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-11T16:45:19.059185-03:00","updated_at":"2025-12-11T17:39:46.13409-03:00","closed_at":"2025-12-11T17:39:46.13409-03:00"}
{"id":"dotfiles-a08","title":"Improve Docker testing workflow","description":"Enhance the Docker-based testing to include more comprehensive validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T16:45:15.225285-03:00","updated_at":"2025-12-11T17:39:46.202846-03:00","closed_at":"2025-12-11T17:39:46.202846-03:00"}
{"id":"dotfiles-jyc","title":"Add starship prompt configuration","description":"Install and configure starship prompt for better shell experience","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T16:45:05.184731-03:00","updated_at":"2025-12-11T16:58:18.151264-03:00","closed_at":"2025-12-11T16:58:18.151264-03:00"}
{"id":"dotfiles-s9s","title":"Migrate from Comtrya to chezmoi","description":"Migrate from Comtrya to chezmoi for dotfiles management. This eliminates the need for homeshick symlink management and provides a more powerful templating system with better cross-platform support.\n\n## Key Changes\n- Replace Comtrya manifests (dev/*.yaml) with chezmoi scripts (.chezmoiscripts/)\n- Replace homeshick symlinks with chezmoi's direct file management\n- Migrate dotfiles from home/ to chezmoi naming conventions (dot_, executable_, private_)\n- Use .chezmoiexternal for git repos (nvim config) and binary downloads (neovim, lazygit on Linux)\n\n## Target Platforms\n- macOS: Uses Homebrew for most packages\n- Linux (Ubuntu 22.04): Downloads binaries, compiles screen from source\n\n## Execution Order\nTasks should be done in order: .1 → .2 → .3 → .4 → .5 (test) → .6 (cleanup) → .7 (docs)","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-11T17:39:50.146566-03:00","updated_at":"2025-12-11T17:48:04.581448-03:00"}
{"id":"dotfiles-s9s.1","title":"Create chezmoi core configuration files","description":"Create the foundational chezmoi configuration files at the repository root.\n\n## Files to Create\n\n### 1. .chezmoidata.yaml\nStore version numbers for tools installed from GitHub releases:\n```yaml\nneovim_version: \"v0.10.4\"\nlazygit_version: \"v0.44.1\"\nscreen_version: \"5.0.0\"\nnvm_version: \"v0.40.0\"\nnodejs_version: \"20\"\n```\n\n### 2. .chezmoiexternal.toml.tmpl\nDefine external resources. This file is ALWAYS processed as a template.\n\n```toml\n# Neovim configuration (all platforms)\n[\".config/nvim\"]\n    type = \"git-repo\"\n    url = \"https://github.com/rodrigorm/nvim.git\"\n    refreshPeriod = \"168h\"\n    [\".config/nvim\".pull]\n        args = [\"--ff-only\"]\n\n# Vim configuration (all platforms)  \n[\".vim\"]\n    type = \"git-repo\"\n    url = \"https://github.com/rodrigorm/vim.git\"\n    refreshPeriod = \"168h\"\n    [\".vim\".clone]\n        args = [\"--recurse-submodules\"]\n    [\".vim\".pull]\n        args = [\"--ff-only\"]\n\n# Lazygit binary (Linux only - macOS uses Homebrew)\n{{ if eq .chezmoi.os \"linux\" }}\n[\".local/bin/lazygit\"]\n    type = \"archive-file\"\n    url = \"https://github.com/jesseduffield/lazygit/releases/download/{{ .lazygit_version }}/lazygit_{{ trimPrefix \"v\" .lazygit_version }}_Linux_x86_64.tar.gz\"\n    path = \"lazygit\"\n    executable = true\n{{ end }}\n```\n\n**IMPORTANT NOTES:**\n- The nvim config git-repo replaces the Comtrya git clone in dev/nvim/main.yaml\n- The vim config replaces the homeshick-based setup in dev/vimrc/main.yaml\n- Neovim BINARY installation to /opt/nvim must use a script (task .3) because chezmoi externals can only target paths within $HOME\n- Lazygit on Linux goes to ~/.local/bin (already in PATH per task .2)\n- macOS installs neovim/lazygit via Homebrew in task .3\n\n### 3. .chezmoiignore\nExclude repository meta-files from being copied to home directory.\nUse glob patterns, one per line:\n\n```\n# Build/test files\nMakefile\nDockerfile\n\n# Documentation\nREADME.md\nAGENTS.md\nLICENSE\n\n# Git/lint config\n.gitattributes\n.shellcheckrc\n\n# Development directories\n.devcontainer\n.devcontainer/**\n.beads\n.beads/**\nhistory\nhistory/**\n\n# Legacy Comtrya files (until cleanup in task .6)\nComtrya.yaml\ndev\ndev/**\n\n# Other non-dotfiles\nSolarized Dark.terminal\nbootstrap.sh\n```\n\n**Note:** Directory patterns need both the dir name AND dir/** to fully exclude.\n\n### 4. private_dot_ssh/\nCreate an empty private directory for SSH. chezmoi will create ~/.ssh with mode 0700:\n- Create directory: `private_dot_ssh/`\n- Add empty `.gitkeep` file inside (or use `empty_` prefix file)\n\n## Chezmoi Reference\n- Template variables: `.chezmoi.os` (\"darwin\" or \"linux\"), `.chezmoi.arch` (\"amd64\", \"arm64\")\n- Data from .chezmoidata.yaml accessed as: `{{ .neovim_version }}`\n- External types: `file`, `archive`, `archive-file`, `git-repo`\n- git-repo externals support `clone.args` and `pull.args` for customization\n- `refreshPeriod` controls how often chezmoi re-fetches (168h = 1 week)\n\n## Acceptance Criteria\n- [ ] .chezmoidata.yaml exists with all version variables\n- [ ] .chezmoiexternal.toml.tmpl exists and is valid TOML when rendered\n- [ ] .chezmoiignore excludes all non-dotfile repository files\n- [ ] private_dot_ssh/ directory exists","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:39:55.488475-03:00","updated_at":"2025-12-11T17:57:28.357968-03:00","closed_at":"2025-12-11T17:57:28.357968-03:00","dependencies":[{"issue_id":"dotfiles-s9s.1","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:39:55.489076-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.2","title":"Migrate dotfiles from home/ to chezmoi naming","description":"Migrate all dotfiles from home/ directory to chezmoi naming conventions at repository root.\n\n## Chezmoi Naming Conventions\n- `dot_` prefix → becomes `.` (e.g., `dot_bashrc` → `.bashrc`)\n- `executable_` prefix → sets executable bit on target file\n- `private_` prefix → sets 0600/0700 permissions (files/dirs)\n- `readonly_` prefix → removes write permissions\n- **Order matters:** `private_dot_` not `dot_private_`\n- Directories do NOT use `executable_` prefix\n\n## Complete File Migration Map\n\n### Root Dotfiles (home/*.* → repo root)\n| Source | Target | Notes |\n|--------|--------|-------|\n| home/.bashrc | dot_bashrc | |\n| home/.bash_profile | dot_bash_profile | |\n| home/.profile | dot_profile | |\n| home/.gitconfig | dot_gitconfig | |\n| home/.screenrc | dot_screenrc | |\n| home/.ctags | dot_ctags | |\n| home/.editorconfig | dot_editorconfig | |\n| home/.grcat | dot_grcat | |\n| home/.hyper.js | dot_hyper.js | |\n| home/.my.cnf | dot_my.cnf | |\n| home/.i3status.conf | dot_i3status.conf | **Often missed!** |\n\n### Directories (preserve internal structure)\n| Source | Target | Notes |\n|--------|--------|-------|\n| home/.bashrc.d/ | dot_bashrc.d/ | Directory, no executable_ |\n| home/.bashrc.d/.init.sh | dot_bashrc.d/dot_init.sh | Hidden file inside |\n| home/.bashrc.d/*.sh | dot_bashrc.d/*.sh | Keep same names (not hidden) |\n| home/.config/ | dot_config/ | |\n| home/.config/starship.toml | dot_config/starship.toml | Not private |\n| home/.i3/ | dot_i3/ | |\n| home/.i3/config | dot_i3/config | |\n| home/bin/ | bin/ | No dot_ (not hidden) |\n| home/bin/lib/ | bin/lib/ | Subdirectory |\n\n### Executable Scripts in bin/\n| Source | Target | Notes |\n|--------|--------|-------|\n| home/bin/sc | bin/executable_sc | Has shebang, is run directly |\n| home/bin/caps_lock_off | bin/executable_caps_lock_off | Has shebang, is run directly |\n| home/bin/screen-git-branch | bin/executable_screen-git-branch | Has shebang, is run directly |\n| home/bin/lib/bash3boilerplate.sh | bin/lib/bash3boilerplate.sh | **NO executable_** - sourced, not run |\n\n## Content Changes Required\n\n### DELETE: dot_bashrc.d/10-homeshick.sh\nThis file must be completely removed - homeshick is replaced by chezmoi.\nDo NOT migrate this file.\n\n### MODIFY: dot_bashrc.d/10-path.sh\nAdd `~/.local/bin` to PATH for user-installed binaries (lazygit, chezmoi, etc.).\n\nCurrent file ends at line 29. Add this near the top (after the shebang and before other PATH additions):\n\n```bash\n# User local bin (for chezmoi, lazygit, etc.)\n[ -d \"$HOME/.local/bin\" ] \u0026\u0026 PATH=\"$HOME/.local/bin:$PATH\"\n```\n\nInsert after line 4 (the ~/bin check) to keep similar patterns together.\n\n### VERIFY: dot_bashrc.d/.init.sh reference\nThe file `home/.bashrc.d/.init.sh` is referenced by `home/.bashrc`. After migration:\n- Source: dot_bashrc.d/dot_init.sh\n- Target: ~/.bashrc.d/.init.sh (the dot_ becomes .)\n\nVerify that `dot_bashrc` sources `~/.bashrc.d/.init.sh` (it should already be correct).\n\n## Migration Commands\n```bash\n# Create directories first\nmkdir -p dot_bashrc.d dot_config dot_i3 bin/lib\n\n# Move root dotfiles\nmv home/.bashrc dot_bashrc\nmv home/.bash_profile dot_bash_profile\nmv home/.profile dot_profile\nmv home/.gitconfig dot_gitconfig\nmv home/.screenrc dot_screenrc\nmv home/.ctags dot_ctags\nmv home/.editorconfig dot_editorconfig\nmv home/.grcat dot_grcat\nmv home/.hyper.js dot_hyper.js\nmv home/.my.cnf dot_my.cnf\nmv home/.i3status.conf dot_i3status.conf\n\n# Move .bashrc.d contents (rename hidden .init.sh)\nmv home/.bashrc.d/.init.sh dot_bashrc.d/dot_init.sh\nmv home/.bashrc.d/00-reset.sh dot_bashrc.d/\nmv home/.bashrc.d/10-aliases.sh dot_bashrc.d/\nmv home/.bashrc.d/10-homebrew.sh dot_bashrc.d/\nmv home/.bashrc.d/10-nvm.sh dot_bashrc.d/\nmv home/.bashrc.d/10-path.sh dot_bashrc.d/\nmv home/.bashrc.d/10-ssh.sh dot_bashrc.d/\nmv home/.bashrc.d/21-starship.sh dot_bashrc.d/\nmv home/.bashrc.d/30-pyenv.sh dot_bashrc.d/\n# NOTE: Skip 10-homeshick.sh - delete it instead\nrm home/.bashrc.d/10-homeshick.sh\n\n# Move .config\nmv home/.config/starship.toml dot_config/\n\n# Move .i3\nmv home/.i3/config dot_i3/\n\n# Move bin (with executable_ prefix for scripts)\nmv home/bin/sc bin/executable_sc\nmv home/bin/caps_lock_off bin/executable_caps_lock_off\nmv home/bin/screen-git-branch bin/executable_screen-git-branch\nmv home/bin/lib/bash3boilerplate.sh bin/lib/\n```\n\n## Acceptance Criteria\n- [ ] All 11 root dotfiles migrated with dot_ prefix\n- [ ] dot_bashrc.d/ contains 9 files (10 original minus homeshick)\n- [ ] dot_bashrc.d/dot_init.sh exists (was .init.sh)\n- [ ] 10-homeshick.sh is NOT present\n- [ ] 10-path.sh includes ~/.local/bin in PATH\n- [ ] bin/ contains 3 executable_ prefixed scripts\n- [ ] bin/lib/bash3boilerplate.sh exists WITHOUT executable_ prefix\n- [ ] dot_config/starship.toml exists\n- [ ] dot_i3/config exists\n- [ ] dot_i3status.conf exists","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T17:39:58.149573-03:00","updated_at":"2025-12-11T17:58:59.451731-03:00","closed_at":"2025-12-11T17:58:59.451731-03:00","dependencies":[{"issue_id":"dotfiles-s9s.2","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:39:58.150173-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.2","depends_on_id":"dotfiles-s9s.1","type":"blocks","created_at":"2025-12-11T17:50:24.965291-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.3","title":"Create chezmoi installation scripts","description":"Create chezmoi run scripts to replace Comtrya manifests for package/tool installation.\n\n## Directory Structure\nCreate `.chezmoiscripts/` directory at repository root. Scripts in this directory:\n- Run without creating a corresponding directory in the target\n- Must have `run_` prefix to be recognized as scripts\n- Are executed in alphabetical order within their timing category\n\n## Script Naming Convention\n| Prefix | Behavior |\n|--------|----------|\n| `run_before_` | Run every time, before dotfiles are applied |\n| `run_after_` | Run every time, after dotfiles are applied |\n| `run_once_before_` | Run once (tracked by content hash), before dotfiles |\n| `run_once_` | Run once, during normal application |\n| `run_onchange_` | Run when script content changes (good for version bumps) |\n\nAdd `.tmpl` suffix to process as template (required for OS detection).\n\n## Scripts to Create\n\n### 1. .chezmoiscripts/run_once_before_00-install-packages.sh.tmpl\nInstall base packages needed by subsequent scripts.\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\n{{ if eq .chezmoi.os \"darwin\" -}}\n# macOS - Homebrew packages\nif ! command -v brew \u0026\u003e /dev/null; then\n    echo \"Homebrew not found. Please install it first.\"\n    exit 1\nfi\n\nbrew install bash bash-completion@2 git vim neovim lazygit\n{{ else if eq .chezmoi.os \"linux\" -}}\n# Linux (Ubuntu/Debian) - apt packages\nsudo apt-get update\nsudo apt-get install -y \\\n    software-properties-common \\\n    bash \\\n    bash-completion \\\n    git \\\n    vim \\\n    build-essential \\\n    unzip \\\n    python3-venv \\\n    ripgrep \\\n    fzf \\\n    libncurses5-dev \\\n    curl \\\n    ca-certificates\n{{ end -}}\n```\n\n**Note:** macOS installs neovim and lazygit via Homebrew here. Linux installs them separately.\n\n### 2. .chezmoiscripts/run_once_10-install-nvm.sh.tmpl\nInstall NVM (Node Version Manager).\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nexport NVM_DIR=\"${NVM_DIR:-$HOME/.nvm}\"\n\nif [[ ! -d \"$NVM_DIR\" ]]; then\n    echo \"Installing NVM {{ .nvm_version }}...\"\n    curl -o- \"https://raw.githubusercontent.com/nvm-sh/nvm/{{ .nvm_version }}/install.sh\" | bash\nfi\n```\n\n### 3. .chezmoiscripts/run_onchange_11-install-nodejs.sh.tmpl\nInstall Node.js via NVM. Uses `run_onchange_` so version changes trigger re-run.\n\n```bash\n#!/bin/bash\n# nodejs_version: {{ .nodejs_version }}\nset -euo pipefail\n\nexport NVM_DIR=\"${NVM_DIR:-$HOME/.nvm}\"\n[ -s \"$NVM_DIR/nvm.sh\" ] \u0026\u0026 source \"$NVM_DIR/nvm.sh\"\n\necho \"Installing Node.js {{ .nodejs_version }}...\"\nnvm install {{ .nodejs_version }}\nnvm alias default {{ .nodejs_version }}\n```\n\n**Note:** The comment with `{{ .nodejs_version }}` ensures the script re-runs when version changes.\n\n### 4. .chezmoiscripts/run_once_20-install-pyenv.sh.tmpl\nInstall pyenv for Python version management.\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nif [[ ! -d \"$HOME/.pyenv\" ]]; then\n    echo \"Installing pyenv...\"\n    curl https://pyenv.run | bash\nfi\n```\n\n### 5. .chezmoiscripts/run_once_30-install-starship.sh.tmpl\nInstall Starship cross-shell prompt.\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nif ! command -v starship \u0026\u003e /dev/null; then\n    echo \"Installing Starship...\"\n    curl -sS https://starship.rs/install.sh | sh -s -- -y\nfi\n```\n\n### 6. .chezmoiscripts/run_onchange_40-install-neovim.sh.tmpl\nInstall Neovim binary (Linux only - macOS uses Homebrew).\n\n```bash\n#!/bin/bash\n# neovim_version: {{ .neovim_version }}\n{{ if eq .chezmoi.os \"linux\" -}}\nset -euo pipefail\n\nNVIM_VERSION=\"{{ .neovim_version }}\"\nNVIM_VERSION_NUM=\"${NVIM_VERSION#v}\"  # Remove leading v\n\n# Check if already installed with correct version\nif [[ -x /opt/nvim/bin/nvim ]]; then\n    INSTALLED=$(/opt/nvim/bin/nvim --version | head -1 | grep -oP \"v\\d+\\.\\d+\\.\\d+\" || echo \"\")\n    if [[ \"$INSTALLED\" == \"$NVIM_VERSION\" ]]; then\n        echo \"Neovim $NVIM_VERSION already installed\"\n        exit 0\n    fi\nfi\n\necho \"Installing Neovim $NVIM_VERSION...\"\ncd /tmp\ncurl -LO \"https://github.com/neovim/neovim/releases/download/${NVIM_VERSION}/nvim-linux-x86_64.tar.gz\"\ntar xzf nvim-linux-x86_64.tar.gz\nsudo rm -rf /opt/nvim\nsudo mv nvim-linux-x86_64 /opt/nvim\nrm -f nvim-linux-x86_64.tar.gz\necho \"Neovim installed to /opt/nvim\"\n{{ end -}}\n```\n\n**Note:** Empty output on macOS means script won't run there.\n\n### 7. .chezmoiscripts/run_onchange_50-install-screen.sh.tmpl\nInstall GNU Screen (Linux: compile from source, macOS: already in packages script).\n\n```bash\n#!/bin/bash\n# screen_version: {{ .screen_version }}\n{{ if eq .chezmoi.os \"linux\" -}}\nset -euo pipefail\n\nSCREEN_VERSION=\"{{ .screen_version }}\"\n\n# Check if already installed with correct version\nif command -v screen \u0026\u003e /dev/null; then\n    INSTALLED=$(screen --version 2\u003e\u00261 | grep -oP \"\\d+\\.\\d+\\.\\d+\" | head -1 || echo \"\")\n    if [[ \"$INSTALLED\" == \"$SCREEN_VERSION\" ]]; then\n        echo \"Screen $SCREEN_VERSION already installed\"\n        exit 0\n    fi\nfi\n\necho \"Compiling Screen $SCREEN_VERSION from source...\"\ncd /tmp\ncurl -fsSL \"https://ftp.gnu.org/gnu/screen/screen-${SCREEN_VERSION}.tar.gz\" -o screen.tar.gz\ntar xzf screen.tar.gz\ncd \"screen-${SCREEN_VERSION}\"\n\n./configure \\\n    --prefix=/usr/local \\\n    --infodir=/usr/share/info \\\n    --mandir=/usr/share/man \\\n    --disable-pam \\\n    --enable-socket-dir=/run/screen \\\n    --with-pty-group=5\n\nmake -j$(nproc)\nsudo make install\nsudo install -m 644 etc/etcscreenrc /etc/screenrc\n\ncd /tmp\nrm -rf \"screen-${SCREEN_VERSION}\" screen.tar.gz\necho \"Screen $SCREEN_VERSION installed\"\n{{ end -}}\n```\n\n### 8. .chezmoiscripts/run_once_60-create-local-bin.sh.tmpl\nEnsure ~/.local/bin exists for user binaries.\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\nmkdir -p \"$HOME/.local/bin\"\n```\n\n**Note:** This runs before externals that need ~/.local/bin (like lazygit).\n\n### 9. .chezmoiscripts/run_once_70-symlink-vimrc.sh.tmpl\nCreate ~/.vimrc symlink to the vim repo (cloned by .chezmoiexternal).\n\n```bash\n#!/bin/bash\nset -euo pipefail\n\n# Wait for .vim to be cloned by externals\nif [[ -d \"$HOME/.vim\" \u0026\u0026 -f \"$HOME/.vim/vimrc\" ]]; then\n    if [[ ! -L \"$HOME/.vimrc\" ]]; then\n        ln -sf \"$HOME/.vim/vimrc\" \"$HOME/.vimrc\"\n        echo \"Created ~/.vimrc symlink\"\n    fi\nfi\n```\n\n## Important Notes\n\n1. **Shebang required**: Every script needs `#!/bin/bash`\n2. **Error handling**: Always use `set -euo pipefail`\n3. **Template rendering**: Scripts with empty output after template processing don't run\n4. **Idempotency**: All scripts should be safe to run multiple times\n5. **Order**: Scripts run alphabetically; use number prefixes (00-, 10-, etc.)\n6. **Sudo**: Scripts run as current user; use `sudo` for privileged operations\n7. **Dependencies**: NVM scripts must source nvm.sh before using nvm commands\n\n## Acceptance Criteria\n- [ ] .chezmoiscripts/ directory exists\n- [ ] All 9 scripts created with correct names\n- [ ] Scripts are valid bash (run `bash -n script.sh` to check)\n- [ ] Template syntax is valid (test with `chezmoi execute-template \u003c script`)\n- [ ] macOS scripts install neovim/lazygit via Homebrew\n- [ ] Linux scripts install neovim binary and compile screen","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-11T17:40:00.093419-03:00","updated_at":"2025-12-11T17:59:07.515391-03:00","dependencies":[{"issue_id":"dotfiles-s9s.3","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:40:00.093766-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.3","depends_on_id":"dotfiles-s9s.1","type":"blocks","created_at":"2025-12-11T17:50:24.993895-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.4","title":"Update bootstrap.sh for chezmoi","description":"Update bootstrap.sh to use chezmoi instead of Comtrya.\n\n## Purpose\nbootstrap.sh is the entry point for:\n- VS Code devcontainers\n- Devpod\n- Manual bootstrap on new machines\n\n## New bootstrap.sh Content\n\n```bash\n#!/usr/bin/env bash\nset -euo pipefail\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" \u0026\u0026 pwd)\"\n\necho \"=== Dotfiles Bootstrap ===\"\n\n# Ensure ~/.local/bin exists and is in PATH (for chezmoi)\nmkdir -p \"$HOME/.local/bin\"\nexport PATH=\"$HOME/.local/bin:$PATH\"\n\n# Install chezmoi if not present\nif ! command -v chezmoi \u0026\u003e /dev/null; then\n    echo \"Installing chezmoi...\"\n    sh -c \"$(curl -fsLS get.chezmoi.io)\" -- -b \"$HOME/.local/bin\"\nfi\n\n# Determine if running from local clone or needs remote init\nif [[ -f \"$SCRIPT_DIR/.chezmoiignore\" ]]; then\n    # Local clone (devcontainer/devpod scenario)\n    echo \"Using local dotfiles from: $SCRIPT_DIR\"\n    chezmoi init --source \"$SCRIPT_DIR\" --apply --verbose\nelse\n    # Remote scenario - clone from GitHub\n    echo \"Cloning dotfiles from GitHub...\"\n    chezmoi init --apply rodrigorm --verbose\nfi\n\necho \"=== Bootstrap complete ===\"\n```\n\n## Key Differences from Current bootstrap.sh\n\n| Current | New |\n|---------|-----|\n| `curl get.comtrya.dev \\| sudo bash` | `sh -c \"$(curl get.chezmoi.io)\" -- -b ~/.local/bin` |\n| `comtrya apply` | `chezmoi init --source $DIR --apply` |\n| Requires sudo for install | No sudo needed |\n| No local/remote detection | Detects local clone vs remote |\n\n## Usage Scenarios\n\n### 1. Devcontainer / Devpod\nThe dotfiles repo is cloned/mounted into the container. bootstrap.sh detects the local `.chezmoiignore` file and uses `--source` to point chezmoi at the existing directory.\n\n```bash\n# Inside container where dotfiles are at /workspace/dotfiles\ncd /workspace/dotfiles\n./bootstrap.sh\n```\n\n### 2. Fresh Machine (Remote)\nPreferred one-liner (doesn't need bootstrap.sh):\n```bash\nsh -c \"$(curl -fsLS get.chezmoi.io)\" -- init --apply rodrigorm\n```\n\nIf bootstrap.sh is run without the repo:\n```bash\ncurl -O https://raw.githubusercontent.com/rodrigorm/dotfiles/main/bootstrap.sh\nchmod +x bootstrap.sh\n./bootstrap.sh  # Will clone from GitHub\n```\n\n### 3. Existing chezmoi User\n```bash\nchezmoi update  # Pull and apply changes\n```\n\n## Technical Notes\n\n1. **No sudo required**: chezmoi installs to `~/.local/bin` by default\n2. **PATH setup**: Script ensures `~/.local/bin` is in PATH before running chezmoi\n3. **Detection method**: Checks for `.chezmoiignore` to detect if in source directory\n4. **Verbose output**: Using `--verbose` for visibility during bootstrap\n5. **Idempotent**: Safe to run multiple times\n\n## Acceptance Criteria\n- [ ] bootstrap.sh updated with new content\n- [ ] Script passes shellcheck\n- [ ] Works in Docker test environment (`make test`)\n- [ ] Correctly detects local vs remote scenario\n- [ ] No sudo required for chezmoi installation","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-11T17:40:00.829194-03:00","updated_at":"2025-12-11T17:54:58.684837-03:00","dependencies":[{"issue_id":"dotfiles-s9s.4","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:40:00.829623-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.4","depends_on_id":"dotfiles-s9s.2","type":"blocks","created_at":"2025-12-11T17:50:25.017871-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.4","depends_on_id":"dotfiles-s9s.3","type":"blocks","created_at":"2025-12-11T17:50:25.043095-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.5","title":"Update Dockerfile and Makefile for chezmoi testing","description":"Update Dockerfile and Makefile to test the chezmoi-based setup.\n\n## Dockerfile Changes\n\n### Current Issues with Existing Dockerfile\n- Multi-stage Rust build is slow and unnecessary\n- Comtrya is built from source (takes minutes)\n- chezmoi is a single pre-built binary\n\n### New Dockerfile\n\n```dockerfile\nFROM ubuntu:22.04\n\n# Prevent interactive prompts during package installation\nENV DEBIAN_FRONTEND=noninteractive\n\n# Restore full Ubuntu (unminimize) and install base packages\nRUN yes | unminimize 2\u003e/dev/null || true \u0026\u0026 \\\n    apt-get update \u0026\u0026 \\\n    apt-get install -y --no-install-recommends \\\n        adduser \\\n        sudo \\\n        curl \\\n        ca-certificates \\\n        git \u0026\u0026 \\\n    rm -rf /var/lib/apt/lists/*\n\n# Create ubuntu user with passwordless sudo\nRUN useradd -m -s /bin/bash ubuntu \u0026\u0026 \\\n    echo \"ubuntu ALL=(ALL) NOPASSWD:ALL\" \u003e\u003e /etc/sudoers\n\n# Install chezmoi system-wide\nRUN sh -c \"$(curl -fsLS get.chezmoi.io)\" -- -b /usr/local/bin\n\n# Copy dotfiles repository\nCOPY --chown=ubuntu:ubuntu . /home/ubuntu/.dotfiles\n\nUSER ubuntu\nWORKDIR /home/ubuntu\nENV SHELL=/bin/bash\nENV TERM=xterm-256color\nSHELL [\"/bin/bash\", \"-c\"]\n```\n\n### Key Changes\n1. **Single stage**: No more Rust builder (saves ~5 minutes)\n2. **Pre-built chezmoi**: Downloaded binary, not compiled\n3. **System-wide install**: `-b /usr/local/bin` so it's available to all users\n4. **Passwordless sudo**: Required for installation scripts\n5. **DEBIAN_FRONTEND**: Prevents apt interactive prompts\n6. **Minimal packages**: Only what's needed to bootstrap; rest installed by chezmoi\n\n## Makefile Changes\n\n### Current Makefile\n```make\ntest: image\n\tdocker run --rm -it dotfiles:latest sh -c \"cd ~/.dotfiles \u0026\u0026 comtrya -vvv apply \u0026\u0026 cd ~ \u0026\u0026 bash\"\n```\n\n### New Makefile test target\n```make\ntest: image\n\tdocker run --rm -it dotfiles:latest sh -c \"chezmoi init --source ~/.dotfiles --apply -v \u0026\u0026 exec bash -l\"\n```\n\n### Updated shellcheck target (after task .6 cleanup)\n```make\nshellcheck:\n\tshellcheck $$(find dot_bashrc.d -type f -name \"*.sh\") \\\n\t           $$(find .chezmoiscripts -type f -name \"*.sh.tmpl\" -o -name \"*.sh\") \\\n\t           bootstrap.sh\n```\n\n**Note:** shellcheck can't parse .tmpl files directly. Either:\n- Run shellcheck on the rendered output, or\n- Use `# shellcheck shell=bash` directive and ignore template syntax\n\n### Complete New Makefile\n```make\n.PHONY: image test prune benchmark shellcheck\n\nimage:\n\tdocker build -t dotfiles:latest .\n\ntest: image\n\tdocker run --rm -it dotfiles:latest sh -c \"chezmoi init --source ~/.dotfiles --apply -v \u0026\u0026 exec bash -l\"\n\nprune:\n\tdocker system prune -f\n\nbenchmark:\n\t__bashrc_bench=1 bash -i\n\nshellcheck:\n\tshellcheck $$(find dot_bashrc.d -type f -name \"*.sh\") bootstrap.sh\n```\n\n## Manual Verification Steps\n\nAfter `make test`, inside the container run these checks:\n\n```bash\n# 1. Dotfiles in place\nls -la ~/\n# Should see: .bashrc, .bash_profile, .gitconfig, .screenrc, etc.\n\n# 2. Directories created\nls -la ~/.bashrc.d/\nls -la ~/.config/\nls ~/bin/\n\n# 3. Neovim config cloned (via external)\nls ~/.config/nvim/\n# Should see nvim config files\n\n# 4. Vim config cloned (via external)\nls ~/.vim/\nls -la ~/.vimrc  # Should be symlink to ~/.vim/vimrc\n\n# 5. Neovim binary installed (Linux)\n/opt/nvim/bin/nvim --version\n# Should show v0.10.4\n\n# 6. Lazygit installed\n~/.local/bin/lazygit --version\n# Or just: lazygit --version (if PATH is set)\n\n# 7. Screen compiled\nscreen --version\n# Should show 5.0.0\n\n# 8. NVM and Node.js\nexport NVM_DIR=\"$HOME/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] \u0026\u0026 . \"$NVM_DIR/nvm.sh\"\nnvm --version\nnode --version\n# Should show Node 20.x\n\n# 9. Starship\nstarship --version\n\n# 10. pyenv\n~/.pyenv/bin/pyenv --version\n\n# 11. Shell works\nbash -l\n# Should start without errors, show starship prompt\n```\n\n## Troubleshooting\n\n| Issue | Solution |\n|-------|----------|\n| \"chezmoi: command not found\" | Check /usr/local/bin/chezmoi exists |\n| Scripts fail with permission denied | Check NOPASSWD sudo is configured |\n| Neovim not found | Check /opt/nvim/bin is in PATH (10-path.sh) |\n| NVM commands fail | Source nvm.sh first |\n| Template errors | Run `chezmoi execute-template \u003c file.tmpl` to debug |\n\n## Acceptance Criteria\n- [ ] Dockerfile updated and builds successfully\n- [ ] `make image` completes in \u003c 2 minutes (vs ~10 minutes with Rust build)\n- [ ] `make test` runs all chezmoi scripts without errors\n- [ ] All 11 verification checks pass inside container\n- [ ] Makefile shellcheck target works (after task .2 migration)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-11T17:40:02.95989-03:00","updated_at":"2025-12-11T17:55:27.873089-03:00","dependencies":[{"issue_id":"dotfiles-s9s.5","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:40:02.961014-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.5","depends_on_id":"dotfiles-s9s.4","type":"blocks","created_at":"2025-12-11T17:50:25.065749-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.6","title":"Remove Comtrya artifacts and home/ directory","description":"Remove Comtrya artifacts after migration is verified working.\n\n## Prerequisites\n- [ ] Task .5 must pass completely\n- [ ] Run `make test` and verify all tools work in container\n- [ ] All 11 verification checks from task .5 pass\n\n**DO NOT START THIS TASK** until testing is complete and passing.\n\n## Files and Directories to Delete\n\n### 1. Comtrya.yaml\nMain Comtrya configuration file at repository root.\n\n### 2. dev/ directory (entire tree)\nAll Comtrya manifests:\n```\ndev/\n├── aptitude/main.yaml\n├── bash/main.yaml\n├── dotfiles/main.yaml\n├── git/main.yaml\n├── homeshick/main.yml\n├── lazygit/main.yaml\n├── neovim/main.yaml\n├── nodejs/main.yaml\n├── nvim/main.yaml\n├── nvm/main.yaml\n├── pyenv/main.yml\n├── screen/main.yaml\n├── ssh/main.yaml\n├── starship/main.yml\n├── vim/main.yaml\n└── vimrc/main.yaml\n```\n\n### 3. home/ directory (entire tree)\nOriginal dotfiles location (now migrated):\n```\nhome/\n├── .bash_profile\n├── .bashrc\n├── .bashrc.d/\n├── .config/\n├── .ctags\n├── .editorconfig\n├── .gitconfig\n├── .grcat\n├── .hyper.js\n├── .i3/\n├── .i3status.conf\n├── .my.cnf\n├── .profile\n├── .screenrc\n└── bin/\n```\n\n## Cleanup Commands\n\n```bash\n# Delete Comtrya config\nrm Comtrya.yaml\n\n# Delete all Comtrya manifests\nrm -rf dev/\n\n# Delete original home directory (contents now at root with chezmoi naming)\nrm -rf home/\n\n# Verify deletion\nls -la\n# Should NOT see: Comtrya.yaml, dev/, home/\n# SHOULD see: dot_bashrc, dot_bashrc.d/, bin/, etc.\n```\n\n## Post-Cleanup Updates\n\n### Update .chezmoiignore\nRemove the legacy entries that are no longer needed:\n\n```diff\n- # Legacy Comtrya files (until cleanup in task .6)\n- Comtrya.yaml\n- dev\n- dev/**\n```\n\nThe .chezmoiignore should now only contain:\n```\n# Build/test files\nMakefile\nDockerfile\n\n# Documentation\nREADME.md\nAGENTS.md\nLICENSE\n\n# Git/lint config\n.gitattributes\n.shellcheckrc\n\n# Development directories\n.devcontainer\n.devcontainer/**\n.beads\n.beads/**\nhistory\nhistory/**\n\n# Other non-dotfiles\nSolarized Dark.terminal\nbootstrap.sh\n```\n\n### Update .shellcheckrc (if needed)\nCurrent config references `home` as source-path:\n```\nexternal-sources=true\nsource-path=home\n```\n\nUpdate to:\n```\nexternal-sources=true\nsource-path=SCRIPTDIR\n```\n\nOr remove the source-path line if not needed.\n\n## Post-Cleanup Verification\n\n```bash\n# 1. Ensure tests still pass\nmake test\n\n# 2. Check shellcheck still works\nmake shellcheck\n\n# 3. Verify git status shows only deletions (no unexpected changes)\ngit status\n\n# 4. Verify chezmoi source state is clean\nchezmoi verify\n```\n\n## Git Commit Message\n```\nchore: remove legacy Comtrya files after chezmoi migration\n\n- Delete Comtrya.yaml configuration\n- Delete dev/ directory with all Comtrya manifests\n- Delete home/ directory (migrated to chezmoi naming)\n- Update .chezmoiignore to remove legacy exclusions\n- Update .shellcheckrc source-path\n\nPart of chezmoi migration (dotfiles-s9s)\n```\n\n## Acceptance Criteria\n- [ ] Comtrya.yaml deleted\n- [ ] dev/ directory deleted\n- [ ] home/ directory deleted\n- [ ] .chezmoiignore updated (legacy entries removed)\n- [ ] .shellcheckrc updated\n- [ ] `make test` still passes after cleanup\n- [ ] `make shellcheck` still passes\n- [ ] Git shows only expected deletions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T17:40:04.2905-03:00","updated_at":"2025-12-11T17:55:49.117316-03:00","dependencies":[{"issue_id":"dotfiles-s9s.6","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:40:04.290841-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.6","depends_on_id":"dotfiles-s9s.5","type":"blocks","created_at":"2025-12-11T17:50:25.086088-03:00","created_by":"daemon"}]}
{"id":"dotfiles-s9s.7","title":"Update README.md with chezmoi instructions","description":"Update README.md with chezmoi installation and usage instructions.\n\n## Current README\nReview existing README.md and replace Comtrya references with chezmoi.\n\n## New README.md Content\n\n```markdown\n# Dotfiles\n\nPersonal dotfiles managed with [chezmoi](https://chezmoi.io/).\n\n## Quick Install\n\nOn a fresh machine, run:\n\n```bash\nsh -c \"$(curl -fsLS get.chezmoi.io)\" -- init --apply rodrigorm\n```\n\n## What Gets Installed\n\n### All Platforms\n- Bash configuration with modular scripts\n- Git configuration\n- GNU Screen configuration\n- [Starship](https://starship.rs/) cross-shell prompt\n- [NVM](https://github.com/nvm-sh/nvm) + Node.js 20\n- [pyenv](https://github.com/pyenv/pyenv)\n- [Neovim](https://neovim.io/) configuration (from [rodrigorm/nvim](https://github.com/rodrigorm/nvim))\n- [Vim](https://www.vim.org/) configuration (from [rodrigorm/vim](https://github.com/rodrigorm/vim))\n\n### macOS (via Homebrew)\n- neovim, lazygit, screen, vim, git, bash-completion\n\n### Linux (Ubuntu)\n- Neovim (pre-built binary)\n- [Lazygit](https://github.com/jesseduffield/lazygit) (pre-built binary)\n- GNU Screen 5.0.0 (compiled from source)\n- Build tools and development packages\n\n## Devcontainer / Devpod\n\nFor VS Code devcontainers or [DevPod](https://devpod.sh/):\n\n```bash\n./bootstrap.sh\n```\n\n## Daily Usage\n\n```bash\n# Pull latest changes and apply\nchezmoi update\n\n# See what would change\nchezmoi diff\n\n# Apply changes\nchezmoi apply\n\n# Edit a dotfile\nchezmoi edit ~/.bashrc\n\n# Add a new file to chezmoi\nchezmoi add ~/.newconfig\n```\n\n## Development\n\n```bash\n# Test in Docker container\nmake test\n\n# Lint shell scripts\nmake shellcheck\n\n# Build Docker image only\nmake image\n\n# Benchmark shell startup time\nmake benchmark\n```\n\n## Repository Structure\n\n```\n.\n├── .chezmoiscripts/          # Installation scripts (packages, tools)\n├── .chezmoidata.yaml         # Version numbers for tools\n├── .chezmoiexternal.toml.tmpl # External git repos (nvim, vim configs)\n├── .chezmoiignore            # Files excluded from home directory\n├── dot_bashrc                # → ~/.bashrc\n├── dot_bashrc.d/             # → ~/.bashrc.d/\n├── dot_config/               # → ~/.config/\n├── dot_gitconfig             # → ~/.gitconfig\n├── dot_screenrc              # → ~/.screenrc\n├── bin/                      # → ~/bin/\n├── private_dot_ssh/          # → ~/.ssh/ (mode 0700)\n├── bootstrap.sh              # Devcontainer bootstrap script\n├── Dockerfile                # Test container\n└── Makefile                  # Development commands\n```\n\n## Customization\n\n### Adding New Dotfiles\n\n```bash\n# Add existing file to chezmoi management\nchezmoi add ~/.newfile\n\n# Add with specific attributes\nchezmoi add --template ~/.config/app.conf  # As template\nchezmoi add --private ~/.secrets           # With restricted permissions\n```\n\n### Modifying Versions\n\nEdit `.chezmoidata.yaml` to change tool versions:\n\n```yaml\nneovim_version: \"v0.10.4\"\nlazygit_version: \"v0.44.1\"\nnodejs_version: \"20\"\n```\n\nThen run `chezmoi apply` to update.\n\n## License\n\n[LGPL](LICENSE)\n```\n\n## Key Changes from Current README\n1. Replace all Comtrya references with chezmoi\n2. Update install one-liner\n3. Add daily usage section\n4. Document repository structure with chezmoi naming\n5. Add customization guide\n6. Keep it concise and scannable\n\n## Acceptance Criteria\n- [ ] README.md updated with new content\n- [ ] All chezmoi commands are correct and tested\n- [ ] Repository structure matches actual file layout (after task .2)\n- [ ] No references to Comtrya remain\n- [ ] Links work (chezmoi.io, GitHub repos)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-11T17:40:06.187533-03:00","updated_at":"2025-12-11T17:56:12.760963-03:00","dependencies":[{"issue_id":"dotfiles-s9s.7","depends_on_id":"dotfiles-s9s","type":"parent-child","created_at":"2025-12-11T17:40:06.188001-03:00","created_by":"daemon"},{"issue_id":"dotfiles-s9s.7","depends_on_id":"dotfiles-s9s.5","type":"blocks","created_at":"2025-12-11T17:50:25.107247-03:00","created_by":"daemon"}]}
